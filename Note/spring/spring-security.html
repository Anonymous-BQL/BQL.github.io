<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SUI pi | Spring security web认证流程</title>
    <meta name="description" content="wenli java number one">
    
    
    <link rel="preload" href="/assets/css/7.styles.5baa8a60.css" as="style"><link rel="preload" href="/assets/js/app.00d2135f.js" as="script"><link rel="preload" href="/assets/js/1.f69a73f7.js" as="script"><link rel="prefetch" href="/assets/js/4.946c6dc3.js"><link rel="prefetch" href="/assets/js/2.19a67a8a.js"><link rel="prefetch" href="/assets/js/3.3a76dc12.js"><link rel="prefetch" href="/assets/js/0.315b259f.js"><link rel="prefetch" href="/assets/js/5.74660d48.js"><link rel="prefetch" href="/assets/js/6.15b12038.js">
    <link rel="stylesheet" href="/assets/css/7.styles.5baa8a60.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      SUI pi
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/Note/java/java1.html" class="nav-link">blog</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Note/java/java1.html" class="nav-link">blog</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Java</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/Note/java/java1.html" class="sidebar-link">java</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Spring</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h2 id="spring-security-web认证流程"><a href="#spring-security-web认证流程" aria-hidden="true" class="header-anchor">#</a> Spring security web认证流程</h2><p>Authentication</p><p>Authentication是一个接口，用来表示用户认证信息的，在用户登录认证之前相关信息会封装为一个Authentication具体实现类的对象，在登录认证成功之后又会生成一个信息更全面，包含用户权限等信息的Authentication对象，然后把它保存在SecurityContextHolder所持有的SecurityContext中，供后续的程序进行调用，如访问权限的鉴定等</p><h3 id="_1-securitycontextpersistencefilter"><a href="#_1-securitycontextpersistencefilter" aria-hidden="true" class="header-anchor">#</a> 1. SecurityContextPersistenceFilter</h3><blockquote><p>负责从SecurityContextRepository获取或存储SecurityContext,在web应用中，就是在请求到来时从session中取出securityContext，请求结束时，将securityContext保存到session中</p></blockquote><h3 id="_2-logoutfilter"><a href="#_2-logoutfilter" aria-hidden="true" class="header-anchor">#</a> 2. LogoutFilter</h3><blockquote><p>监控一个实际为退出功能的URL，并且在匹配的时候完成用户的退出功能。</p></blockquote><h3 id="_3-usernamepasswordauthenticationfilter"><a href="#_3-usernamepasswordauthenticationfilter" aria-hidden="true" class="header-anchor">#</a> 3. UsernamePasswordAuthenticationFilter</h3><blockquote><p>监控一个使用用户名和密码基于form认证的URL，并在URL匹配的情况下尝试认证该用户。</p></blockquote><h3 id="_4-defaultloginpagegeneratingfilter"><a href="#_4-defaultloginpagegeneratingfilter" aria-hidden="true" class="header-anchor">#</a> 4. DefaultLoginPageGeneratingFilter</h3><blockquote><p>监控一个要进行基于forn或OpenID认证的URL，并生成展现登录form的HTML</p></blockquote><h3 id="_5-basicauthenticationfilter"><a href="#_5-basicauthenticationfilter" aria-hidden="true" class="header-anchor">#</a> 5. BasicAuthenticationFilter</h3><blockquote><p>监控HTTP 基础认证的头信息并进行处理</p></blockquote><h3 id="_6-requestcacheawarefilter"><a href="#_6-requestcacheawarefilter" aria-hidden="true" class="header-anchor">#</a> 6. RequestCacheAwareFilter</h3><blockquote><p>用于用户登录成功后，重新恢复由于登录而被打断的请求。</p></blockquote><h3 id="_7-securitycontextholderawarerequestfilter"><a href="#_7-securitycontextholderawarerequestfilter" aria-hidden="true" class="header-anchor">#</a> 7. SecurityContextHolderAwareRequestFilter</h3><blockquote><p>用一个扩展了HttpServletRequestWrapper的子类,包装HttpServletRequest。它为请求处理器提供了额外的上下文信息</p></blockquote><h3 id="_8-anonymousauthenticationfilter"><a href="#_8-anonymousauthenticationfilter" aria-hidden="true" class="header-anchor">#</a> 8. AnonymousAuthenticationFilter</h3><blockquote><p>如果用户到这一步还没有经过认证，将会为这个请求关联一个认证的token，标识此用户是匿名的。</p></blockquote><h3 id="_9-sessionmanagementfilter"><a href="#_9-sessionmanagementfilter" aria-hidden="true" class="header-anchor">#</a> 9. SessionManagementFilter</h3><blockquote><p>根据认证的安全实体信息跟踪session，保证所有关联一个安全实体的session都能被跟踪到。</p></blockquote><h3 id="_10-exceptiontranslationfilter"><a href="#_10-exceptiontranslationfilter" aria-hidden="true" class="header-anchor">#</a> 10.  ExceptionTranslationFilter</h3><blockquote><p>ExceptionTranslationFilter是用来处理来自AbstractSecurityInterceptor抛出的AuthenticationException和AccessDeniedException的。当ExceptionTranslationFilter捕获到的是AuthenticationException时将调用AuthenticationEntryPoint引导用户进行登录；如果捕获的是AccessDeniedException，但是用户还没有通过认证，则调用AuthenticationEntryPoint引导用户进行登录认证，否则将返回一个表示不存在对应权限的403错误码</p></blockquote><h3 id="_11-abstractsecurityinterceptor"><a href="#_11-abstractsecurityinterceptor" aria-hidden="true" class="header-anchor">#</a> 11. AbstractSecurityInterceptor</h3><blockquote><p>AbstractSecurityInterceptor 是Spring Security用于拦截请求进行权限鉴定的，其拥有两个具体的子类，拦截方法调用的 MethodSecurityInterceptor 和拦截URL请求的 FilterSecurityInterceptor。</p></blockquote><h3 id="_12-securitycontextholder"><a href="#_12-securitycontextholder" aria-hidden="true" class="header-anchor">#</a> 12. SecurityContextHolder</h3><blockquote><p>根据三种不同的策略MODE_THREADLOCAL、MODE_INHERITABLETHREADLOCAL和MODE_GLOBAL 来保存SecurityContext web中使用第一个策略，将SecurityContext保存在ThreadLocal中</p></blockquote><h3 id="_13-authenticationmanager"><a href="#_13-authenticationmanager" aria-hidden="true" class="header-anchor">#</a> 13. AuthenticationManager</h3><blockquote><p>AuthenticationManager的默认实现是ProviderManager，而且它不直接自己处理认证请求，而是委托给其所配置的AuthenticationProvider列表，然后会依次使用每一个AuthenticationProvider进行认证，如果有一个AuthenticationProvider认证后的结果不为null，则表示该AuthenticationProvider已经认证成功，之后的AuthenticationProvider将不再继续认证。然后直接以该AuthenticationProvider的认证结果作为ProviderManager的认证结果。</p></blockquote><h3 id="_14-authenticationprovider"><a href="#_14-authenticationprovider" aria-hidden="true" class="header-anchor">#</a> 14. AuthenticationProvider</h3><blockquote><p>Spring Security内部的DaoAuthenticationProvider内部使用UserDetailsService来负责加载UserDetails，并将UserDetails封装到Authentication中</p></blockquote><h3 id="_15-userdetailsservice"><a href="#_15-userdetailsservice" aria-hidden="true" class="header-anchor">#</a> 15. UserDetailsService</h3><blockquote><p>登录认证的时候Spring Security会通过UserDetailsService的loadUserByUsername()方法获取对应的UserDetails进行认证，认证通过后会将该UserDetails赋给认证通过的Authentication的principal，然后再把该Authentication存入到SecurityContext中。</p></blockquote></div><!----><!----></div></div></div>
    <script src="/assets/js/1.f69a73f7.js" defer></script><script src="/assets/js/app.00d2135f.js" defer></script>
  </body>
</html>
